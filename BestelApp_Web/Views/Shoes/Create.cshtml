@model BestelApp_Models.Shoe
@inject BestelApp_Models.ApplicationDbContext Db

@{
    ViewData["Title"] = "Nieuwe Schoen Toevoegen";
    var categories = Db.Categories.OrderBy(c => c.Name).ToList();
}

<!-- DEBUG: Aantal categories: @categories.Count -->
@foreach(var cat in categories)
{
    <!-- DEBUG: Category - ID: @cat.Id, Name: @cat.Name -->
}

<h1 class="display-4 mb-4">Nieuwe Schoen Toevoegen</h1>

<div class="row">
    <div class="col-md-6">
        <form asp-action="Create" method="post" novalidate>
            <div asp-validation-summary="All" class="alert alert-danger" role="alert">
                <strong>⚠️ Fout bij opslaan:</strong>
                <p>Controleer de velden hieronder en probeer opnieuw.</p>
            </div>
            
            <div class="form-group mb-3">
                <label asp-for="Name" class="form-label">Naam *</label>
                <input asp-for="Name" class="form-control" placeholder="Bijv. Air Max 90" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Brand" class="form-label">Merk *</label>
                <input asp-for="Brand" class="form-control" placeholder="Bijv. Nike" />
                <span asp-validation-for="Brand" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Description" class="form-label">Beschrijving *</label>
                <textarea asp-for="Description" class="form-control" rows="3" placeholder="Beschrijf de schoen..."></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label for="CategoryId" class="form-label">Categorie *</label>
                <select asp-for="CategoryId" class="form-select" required>
                    @if (categories.Any())
                    {
                        foreach (var category in categories)
                        {
                            <option value="@category.Id">@category.Name</option>
                        }
                    }
                    else
                    {
                        <option value="0" disabled>Geen categorieën beschikbaar</option>
                    }
                </select>
                <span asp-validation-for="CategoryId" class="text-danger"></span>
                <small class="form-text text-muted">
                    @if (categories.Any())
                    {
                        <span>Selecteer de juiste categorie (@categories.Count categorieën beschikbaar)</span>
                    }
                    else
                    {
                        <span class="text-danger">⚠️ Geen categorieën gevonden! Voeg eerst categorieën toe.</span>
                    }
                </small>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Price" class="form-label">Prijs (€) *</label>
                <input asp-for="Price" type="number" step="0.01" min="0.01" class="form-control" placeholder="99.99" />
                <span asp-validation-for="Price" class="text-danger"></span>
                <small class="form-text text-muted">Gebruik een punt (.) voor decimalen</small>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Gender" class="form-label">Geslacht *</label>
                <select asp-for="Gender" class="form-select">
                    <option value="Male">Heren</option>
                    <option value="Female">Dames</option>
                    <option value="Unisex" selected>Unisex</option>
                </select>
                <span asp-validation-for="Gender" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="ImageUrl" class="form-label">Afbeelding URL (optioneel)</label>
                <input asp-for="ImageUrl" class="form-control" placeholder="https://..." />
                <span asp-validation-for="ImageUrl" class="text-danger"></span>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label asp-for="Size" class="form-label">Maat (optioneel)</label>
                        <input asp-for="Size" type="number" class="form-control" placeholder="42" />
                        <span asp-validation-for="Size" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label asp-for="Color" class="form-label">Kleur (optioneel)</label>
                        <input asp-for="Color" class="form-control" placeholder="Zwart" />
                        <span asp-validation-for="Color" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="form-check mb-3">
                <input asp-for="IsActive" class="form-check-input" type="checkbox" checked />
                <label asp-for="IsActive" class="form-check-label">Actief (zichtbaar in winkel)</label>
            </div>

            <div class="form-group mt-4">
                <button type="submit" class="btn btn-success btn-lg me-2" onclick="console.log('Submit clicked')">
                    <i class="bi bi-check-circle"></i> Opslaan
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg">
                    <i class="bi bi-x-circle"></i> Annuleren
                </a>
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Debug validatie en form submit
        $(document).ready(function() {
            // Log de geselecteerde CategoryId bij elke change
            $('#CategoryId').on('change', function() {
                var selectedValue = $(this).val();
                var selectedText = $(this).find('option:selected').text();
                console.log('🔄 Category changed:', selectedText, '(ID:', selectedValue + ')');
            });
            
            $('form').on('submit', function(e) {
                console.log('📝 Form submit event triggered');
                
                // Log CategoryId waarde
                var categoryId = $('#CategoryId').val();
                console.log('📦 CategoryId value being sent:', categoryId);
                
                var isValid = $(this).valid();
                console.log('✅ Form valid:', isValid);
                
                if (!isValid) {
                    console.log('⚠️ Validation errors detected');
                    // Scroll naar eerste error
                    var firstError = $('.field-validation-error:first');
                    if (firstError.length > 0) {
                        $('html, body').animate({
                            scrollTop: firstError.closest('.form-group').offset().top - 100
                        }, 500);
                    }
                }
            });
        });
    </script>
}
